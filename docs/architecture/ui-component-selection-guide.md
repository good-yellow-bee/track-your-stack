# UI Component Selection Guide

**Decision Framework: Magic MCP vs shadcn/ui**

Last Updated: 2025-10-10

## Overview

Track Your Stack uses a hybrid UI component strategy combining **shadcn/ui** for base primitives and **Magic MCP** for complex composed components. This guide helps you decide which approach to use when building new features.

## Quick Decision Tree

```
Need a UI component?
├─ Is it a basic primitive? (button, input, card, modal)
│  └─ ✅ Use shadcn/ui
│
├─ Is it a complex composed component? (data table, chart, multi-step form)
│  ├─ Does it exist in shadcn/ui? (e.g., basic table)
│  │  ├─ Needs advanced features? (sorting, filtering, pagination)
│  │  │  └─ ✅ Use Magic MCP
│  │  └─ Basic usage is sufficient?
│  │     └─ ✅ Use shadcn/ui
│  │
│  └─ Not in shadcn/ui? (charts, advanced forms)
│     └─ ✅ Use Magic MCP
│
└─ Is it business logic specific? (investment calculator, portfolio aggregator)
   └─ ✅ Build custom component (may use shadcn/ui primitives)
```

## Component Categories

### Category 1: Always Use shadcn/ui

**Base UI Primitives** - These are the building blocks for all UIs:

| Component | When to Use | Example |
|-----------|------------|---------|
| `Button` | All clickable actions | Save Portfolio, Delete Investment |
| `Input` | Simple text entry | Portfolio name, ticker symbol |
| `Label` | Form field labels | "Portfolio Name", "Asset Type" |
| `Card` | Simple containers | Wrapper for portfolio summary |
| `Dialog` | Basic modals | Confirmation dialogs, alerts |
| `Select` | Simple dropdowns | Currency selector (if < 10 options) |
| `Dropdown Menu` | Context menus | Row actions in tables |
| `Form` | Form structure | Wrapping form elements |

**Usage Pattern:**

```tsx
// ✅ Good: Use shadcn/ui for basic form
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'

export function CreatePortfolioForm() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Create Portfolio</CardTitle>
      </CardHeader>
      <CardContent>
        <form>
          <Label htmlFor="name">Portfolio Name</Label>
          <Input id="name" placeholder="My Portfolio" />
          <Button type="submit">Create</Button>
        </form>
      </CardContent>
    </Card>
  )
}
```

### Category 2: Always Use Magic MCP

**Complex Composed Components** - When you need production-ready interactive patterns:

| Component | When to Use | Magic Command | Example |
|-----------|------------|---------------|---------|
| **Data Tables** | Sorting, filtering, pagination, selection | `/ui create data table with...` | Investment list with sort/filter |
| **Charts** | Data visualization | `/ui create chart component...` | Portfolio performance line chart |
| **Multi-Step Forms** | Wizards, onboarding flows | `/ui create multi-step form...` | Add Investment wizard |
| **Advanced Selectors** | Searchable, multi-select with 50+ options | `/ui create searchable select...` | Stock ticker search |
| **Dashboard Cards** | Interactive metrics with actions | `/ui create dashboard card...` | Portfolio summary with expand |
| **Date Pickers** | Complex date selection | `/ui create date picker...` | Purchase date selector with range |

**Usage Pattern:**

```tsx
// ✅ Good: Use Magic MCP for complex data table
// Command: /ui create investment data table with sorting, filtering, and pagination

// Generated by Magic MCP
import { InvestmentDataTable } from '@/components/investment/investment-data-table'

export function PortfolioInvestmentsPage({ portfolioId }: { portfolioId: string }) {
  const investments = await getPortfolioInvestments(portfolioId)

  return (
    <div>
      <h1>Investments</h1>
      <InvestmentDataTable
        data={investments}
        columns={[
          { key: 'ticker', label: 'Ticker', sortable: true },
          { key: 'quantity', label: 'Quantity', sortable: true },
          { key: 'currentValue', label: 'Current Value', sortable: true },
          { key: 'gainLoss', label: 'Gain/Loss', sortable: true, filterable: true },
        ]}
        onRowClick={(investment) => router.push(`/investments/${investment.id}`)}
      />
    </div>
  )
}
```

### Category 3: Hybrid Approach

**Business Components** - Custom components that use shadcn/ui primitives internally:

These are components specific to your business logic that compose shadcn/ui primitives.

| Component | Approach | Why |
|-----------|----------|-----|
| `PortfolioCard` | Custom + shadcn/ui | Uses `Card`, `Button` from shadcn, adds business logic |
| `InvestmentForm` | Custom + shadcn/ui | Uses `Input`, `Select` from shadcn, adds validation |
| `CurrencyConverter` | Custom + Magic MCP | Uses Magic's currency selector + custom conversion logic |
| `GainLossIndicator` | Custom + shadcn/ui | Uses shadcn styling, adds color logic |

**Usage Pattern:**

```tsx
// ✅ Good: Custom component with shadcn/ui primitives
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { formatCurrency, calculateGainLoss } from '@/lib/calculations'

interface PortfolioCardProps {
  portfolio: Portfolio
  investments: Investment[]
}

export function PortfolioCard({ portfolio, investments }: PortfolioCardProps) {
  const { totalValue, totalCost, gainLoss, gainLossPercent } = calculatePortfolioMetrics(
    investments,
    portfolio.baseCurrency
  )

  return (
    <Card>
      <CardHeader>
        <CardTitle>{portfolio.name}</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="space-y-2">
          <div className="flex justify-between">
            <span>Total Value:</span>
            <span className="font-bold">
              {formatCurrency(totalValue, portfolio.baseCurrency)}
            </span>
          </div>
          <div className="flex justify-between">
            <span>Gain/Loss:</span>
            <span className={gainLoss >= 0 ? 'text-green-600' : 'text-red-600'}>
              {formatCurrency(gainLoss, portfolio.baseCurrency)} ({gainLossPercent}%)
            </span>
          </div>
        </div>
        <Button onClick={() => router.push(`/portfolios/${portfolio.id}`)}>
          View Details
        </Button>
      </CardContent>
    </Card>
  )
}
```

## Specific Use Cases for Track Your Stack

### 1. Investment List Table (Portfolio Detail Page)

**Component Type:** Complex Data Table
**Recommended:** Magic MCP

**Features Needed:**
- Sorting by ticker, quantity, current value, gain/loss
- Filtering by asset type (Stock, ETF, Crypto, etc.)
- Pagination (if > 20 investments)
- Row selection for batch actions
- Expandable rows to show purchase history

**Magic Command:**

```bash
/ui create investment data table with the following columns:
- Ticker (text, sortable)
- Asset Type (badge, filterable)
- Quantity (number, sortable)
- Avg Cost Basis (currency, sortable)
- Current Price (currency, real-time)
- Current Value (currency, sortable)
- Gain/Loss (currency with color indicator, sortable)
- Gain/Loss % (percentage with color indicator, sortable)
- Actions (dropdown menu)

Include:
- Sorting on all columns
- Filtering by asset type
- Search by ticker
- Pagination (20 per page)
- Expandable rows showing purchase transactions
```

**Integration:**

```tsx
// components/investment/investment-list-table.tsx (generated by Magic MCP)
// app/(dashboard)/portfolios/[id]/page.tsx

import { InvestmentListTable } from '@/components/investment/investment-list-table'

export default async function PortfolioDetailPage({ params }: { params: { id: string } }) {
  const portfolio = await getPortfolioWithInvestments(params.id)

  return (
    <div>
      <h1>{portfolio.name}</h1>
      <InvestmentListTable investments={portfolio.investments} />
    </div>
  )
}
```

### 2. Portfolio Performance Chart (Dashboard)

**Component Type:** Data Visualization
**Recommended:** Magic MCP

**Features Needed:**
- Line chart showing portfolio value over time
- Multiple portfolios comparison
- Date range selector
- Tooltips with detailed values
- Responsive design

**Magic Command:**

```bash
/ui create portfolio performance line chart with:
- X-axis: Date range (selectable: 1W, 1M, 3M, 6M, 1Y, All)
- Y-axis: Portfolio value in base currency
- Multiple lines for different portfolios (color-coded)
- Interactive tooltips showing exact values on hover
- Legend with portfolio names
- Responsive layout for mobile
```

**Integration:**

```tsx
// components/portfolio/portfolio-performance-chart.tsx (generated by Magic MCP)
// app/(dashboard)/dashboard/page.tsx

import { PortfolioPerformanceChart } from '@/components/portfolio/portfolio-performance-chart'

export default async function DashboardPage() {
  const portfolios = await getUserPortfolios()
  const performanceData = await getPortfolioPerformanceHistory(portfolios)

  return (
    <div>
      <h1>Dashboard</h1>
      <PortfolioPerformanceChart data={performanceData} />
    </div>
  )
}
```

### 3. Add Investment Form (Multi-Step Wizard)

**Component Type:** Multi-Step Form
**Recommended:** Magic MCP

**Features Needed:**
- Step 1: Asset type selection
- Step 2: Ticker search and validation
- Step 3: Purchase details (quantity, cost, date)
- Step 4: Currency selection
- Step 5: Review and confirm
- Form validation at each step
- Progress indicator

**Magic Command:**

```bash
/ui create multi-step investment form with 5 steps:

Step 1: Asset Type Selection
- Radio buttons: Stock, ETF, Mutual Fund, Cryptocurrency, Other

Step 2: Ticker Search
- Searchable input with autocomplete
- Integration with Alpha Vantage API
- Display company name and exchange

Step 3: Purchase Details
- Quantity (number input)
- Cost per unit (currency input)
- Purchase date (date picker)

Step 4: Currency Selection
- Dropdown with search (100+ currencies)

Step 5: Review and Confirm
- Summary of all entered data
- Edit buttons to go back to each step

Include:
- Step progress indicator
- Form validation at each step
- Back/Next/Submit buttons
- Loading states during API calls
```

**Integration:**

```tsx
// components/investment/add-investment-wizard.tsx (generated by Magic MCP)
// app/(dashboard)/portfolios/[id]/add-investment/page.tsx

import { AddInvestmentWizard } from '@/components/investment/add-investment-wizard'
import { createInvestment } from '@/lib/actions/investment'

export default function AddInvestmentPage({ params }: { params: { id: string } }) {
  return (
    <div>
      <h1>Add Investment</h1>
      <AddInvestmentWizard
        portfolioId={params.id}
        onSubmit={createInvestment}
        onCancel={() => router.back()}
      />
    </div>
  )
}
```

### 4. Portfolio Summary Cards (Dashboard Grid)

**Component Type:** Dashboard Cards
**Recommended:** Hybrid (Custom + shadcn/ui)

**Why Not Magic MCP?** These cards are simple and highly specific to business logic. shadcn/ui `Card` component with custom content is sufficient.

**Implementation:**

```tsx
// components/portfolio/portfolio-summary-card.tsx
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { calculatePortfolioMetrics } from '@/lib/calculations/portfolio'

export function PortfolioSummaryCard({ portfolio }: { portfolio: Portfolio }) {
  const metrics = calculatePortfolioMetrics(portfolio)

  return (
    <Card>
      <CardHeader>
        <CardTitle>{portfolio.name}</CardTitle>
      </CardHeader>
      <CardContent>
        {/* Custom business logic rendering */}
        <MetricsDisplay metrics={metrics} />
        <Button>View Details</Button>
      </CardContent>
    </Card>
  )
}
```

### 5. Currency Selector

**Component Type:** Searchable Select
**Recommended:** Magic MCP (100+ currencies)

**Why Magic MCP?** shadcn/ui `Select` is not searchable by default. For 100+ currencies, a searchable component is essential.

**Magic Command:**

```bash
/ui create currency selector with:
- Searchable dropdown (filter by currency code or name)
- Display format: "USD - United States Dollar"
- Popular currencies at top
- Flag icons for visual recognition
- Recently used currencies section
```

### 6. Date Range Picker (Portfolio Performance Filter)

**Component Type:** Date Picker
**Recommended:** Magic MCP

**Why Magic MCP?** shadcn/ui doesn't have a built-in date picker. Magic MCP can generate a full-featured date range component.

**Magic Command:**

```bash
/ui create date range picker with:
- Start date and end date inputs
- Calendar popup for visual selection
- Quick select buttons (1W, 1M, 3M, 6M, 1Y, All)
- Validation (start date must be before end date)
- Responsive mobile-friendly design
```

## Integration Patterns

### Pattern 1: Magic Component + shadcn/ui Actions

Use Magic MCP for the main component, shadcn/ui for action buttons.

```tsx
import { InvestmentDataTable } from '@/components/investment/investment-data-table' // Magic MCP
import { Button } from '@/components/ui/button' // shadcn/ui
import { DropdownMenu } from '@/components/ui/dropdown-menu' // shadcn/ui

export function InvestmentsPage() {
  return (
    <div>
      <div className="flex justify-between mb-4">
        <h1>Investments</h1>
        <Button>Add Investment</Button>
      </div>
      <InvestmentDataTable data={investments} />
    </div>
  )
}
```

### Pattern 2: Custom Component Wrapping Magic Component

Add business logic around Magic-generated components.

```tsx
// Wrapper for Magic MCP component with business logic
import { PortfolioPerformanceChart } from '@/components/portfolio/portfolio-performance-chart' // Magic MCP
import { useCurrencyConversion } from '@/lib/hooks/use-currency-conversion'

export function ConvertiblePerformanceChart({ data, targetCurrency }: Props) {
  const convertedData = useCurrencyConversion(data, targetCurrency)

  return <PortfolioPerformanceChart data={convertedData} />
}
```

### Pattern 3: Magic Component in shadcn/ui Layout

Use shadcn/ui for layout structure, Magic for content.

```tsx
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card' // shadcn/ui
import { PortfolioAllocationChart } from '@/components/portfolio/portfolio-allocation-chart' // Magic MCP

export function PortfolioOverview({ portfolio }: Props) {
  return (
    <div className="grid grid-cols-2 gap-4">
      <Card>
        <CardHeader>
          <CardTitle>Asset Allocation</CardTitle>
        </CardHeader>
        <CardContent>
          <PortfolioAllocationChart data={portfolio.investments} />
        </CardContent>
      </Card>
      {/* More cards... */}
    </div>
  )
}
```

## Styling Consistency

### Tailwind Configuration

Both Magic MCP and shadcn/ui use Tailwind CSS. Ensure consistency by:

1. **Use shared Tailwind config** (`tailwind.config.ts`)
2. **Define consistent color palette** in Tailwind config
3. **Use shadcn/ui theme variables** for colors

```ts
// tailwind.config.ts
export default {
  theme: {
    extend: {
      colors: {
        // Use shadcn/ui color system
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        // ... other shadcn/ui colors
      },
    },
  },
}
```

### Customizing Magic Components

When Magic MCP generates components, you may need to adjust styling:

```tsx
// Before (Magic generated)
<div className="bg-blue-500 text-white p-4">...</div>

// After (match shadcn/ui theme)
<div className="bg-primary text-primary-foreground p-4">...</div>
```

**Rule:** Always use shadcn/ui theme variables (`primary`, `secondary`, `accent`, etc.) instead of hardcoded Tailwind colors.

## Testing Strategy

### shadcn/ui Components

- Generally don't need extensive testing (well-tested library)
- Test your custom logic that uses shadcn components

### Magic MCP Components

- **DO test:** Generated components are new code
- **Focus on:** Interactions, sorting, filtering, data transformations
- **Use:** React Testing Library + Vitest

```tsx
// __tests__/investment-data-table.test.tsx
import { render, screen, fireEvent } from '@testing-library/react'
import { InvestmentDataTable } from '@/components/investment/investment-data-table'

describe('InvestmentDataTable', () => {
  it('should sort by gain/loss when column header clicked', () => {
    render(<InvestmentDataTable data={mockInvestments} />)

    const gainLossHeader = screen.getByText('Gain/Loss')
    fireEvent.click(gainLossHeader)

    // Assert sorting order
    expect(screen.getByText('$1,000.00')).toBeInTheDocument()
  })
})
```

## Performance Considerations

### When to Optimize

- **Data Tables:** Virtualize for > 100 rows
- **Charts:** Debounce real-time updates
- **Forms:** Use controlled components only when necessary

### Magic MCP Optimization

Magic-generated components may need optimization:

```tsx
// Add React.memo for expensive re-renders
import { memo } from 'react'

export const InvestmentDataTable = memo(function InvestmentDataTable({ data }: Props) {
  // Magic generated code...
})

// Add useMemo for expensive calculations
import { useMemo } from 'react'

export function PortfolioChart({ data }: Props) {
  const processedData = useMemo(() => {
    return data.map(/* expensive transformation */)
  }, [data])

  return <Chart data={processedData} />
}
```

## Accessibility

Both shadcn/ui and Magic MCP prioritize accessibility, but always verify:

### Checklist

- [ ] Keyboard navigation works (Tab, Enter, Escape)
- [ ] Screen reader labels present (aria-label, aria-labelledby)
- [ ] Color contrast meets WCAG AA standards
- [ ] Focus indicators visible
- [ ] Error messages announced to screen readers

### Testing

```bash
# Use Playwright for accessibility testing
pnpm add -D @axe-core/playwright

# Run accessibility tests
pnpm test:a11y
```

## Migration Strategy

If you need to replace an existing component:

### Step 1: Identify Candidate

Look for components with:
- Complex logic (sorting, filtering, pagination)
- Low test coverage
- High maintenance burden
- Inconsistent styling

### Step 2: Generate with Magic MCP

```bash
/ui create [replacement component description]
```

### Step 3: Gradual Migration

```tsx
// Before (old component)
import { OldInvestmentTable } from '@/components/investment/old-investment-table'

// During migration (feature flag)
import { InvestmentDataTable } from '@/components/investment/investment-data-table'
import { OldInvestmentTable } from '@/components/investment/old-investment-table'

const useNewTable = process.env.NEXT_PUBLIC_USE_NEW_TABLE === 'true'

export function InvestmentsPage() {
  return useNewTable ? <InvestmentDataTable /> : <OldInvestmentTable />
}

// After migration (remove old component)
import { InvestmentDataTable } from '@/components/investment/investment-data-table'
```

## Troubleshooting

### Issue: Magic Component Doesn't Match Design System

**Solution:** Customize generated component to use shadcn/ui theme variables.

```tsx
// Replace hardcoded colors
- className="bg-blue-500"
+ className="bg-primary"

- className="text-gray-700"
+ className="text-foreground"
```

### Issue: shadcn/ui Component Too Limited

**Example:** `Select` component can't handle 100+ options with search.

**Solution:** Use Magic MCP to generate searchable select component.

```bash
/ui create searchable select with 100+ options and search functionality
```

### Issue: Duplicate Functionality

**Example:** Both shadcn/ui `Table` and Magic-generated `DataTable` exist.

**Solution:** Use decision tree - if you need sorting/filtering/pagination, always use Magic MCP version.

## Summary: When to Use What

| Scenario | Use shadcn/ui | Use Magic MCP | Use Custom |
|----------|---------------|---------------|------------|
| Button, Input, Label | ✅ | ❌ | ❌ |
| Basic Card, Dialog | ✅ | ❌ | ❌ |
| Simple Form (< 5 fields) | ✅ | ❌ | ❌ |
| Data Table with sorting/filtering | ❌ | ✅ | ❌ |
| Charts and Visualizations | ❌ | ✅ | ❌ |
| Multi-Step Forms | ❌ | ✅ | ❌ |
| Searchable Select (50+ options) | ❌ | ✅ | ❌ |
| Business Logic Component | ❌ | ❌ | ✅ (use shadcn primitives) |
| Component with Complex Calculations | ❌ | ❌ | ✅ (use shadcn primitives) |

## Quick Reference Commands

### Magic MCP Commands for Common Track Your Stack Needs

```bash
# Investment data table
/ui create investment data table with sorting, filtering, pagination

# Portfolio performance chart
/ui create portfolio performance line chart with date range selector

# Add investment wizard
/ui create multi-step investment form with 5 steps

# Currency selector
/ui create searchable currency selector with 100+ currencies

# Asset allocation chart
/ui create pie chart for portfolio asset allocation

# Date range picker
/ui create date range picker with quick select buttons

# Portfolio comparison table
/ui create comparison table for multiple portfolios

# Transaction history timeline
/ui create transaction timeline with date grouping
```

## Additional Resources

- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [Magic MCP Documentation](https://21st.dev/)
- [Track Your Stack Component Structure](/docs/architecture/)
- [Tailwind CSS Configuration](/tailwind.config.ts)

---

**Questions?** Ask in the project discussion or create an issue on GitHub.
